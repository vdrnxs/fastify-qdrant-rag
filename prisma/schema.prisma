// Prisma schema for file tracking system

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "sqlite"
}

// Tabla principal de archivos monitorizados
model File {
  id            String   @id @default(cuid())
  filePath      String   @unique
  fileName      String
  fileExtension String
  fileSize      Int

  contentHash   String

  status        FileStatus @default(PENDING)
  lastModified  DateTime
  lastScanned   DateTime @default(now())

  processingAttempts Int @default(0)
  lastError     String?

  documents     Document[]

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([status])
  @@index([contentHash])
}

model Document {
  id          String   @id @default(cuid())

  fileId      String
  file        File     @relation(fields: [fileId], references: [id], onDelete: Cascade)

  qdrantPointId String
  chunkIndex    Int
  chunkText     String

  metadata      String?

  createdAt     DateTime @default(now())

  @@index([fileId])
  @@index([qdrantPointId])
}

enum FileStatus {
  PENDING
  PROCESSING
  COMPLETED
  ERROR
  MODIFIED
  DELETED
}
