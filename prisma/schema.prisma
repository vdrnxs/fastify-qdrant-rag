// Prisma schema for file tracking system

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "sqlite"
}

// Tabla principal de archivos monitorizados
model File {
  id            String   @id @default(cuid())
  filePath      String   @unique
  fileName      String
  fileExtension String
  fileSize      Int

  contentHash   String

  status        FileStatus @default(PENDING)
  lastModified  DateTime
  lastScanned   DateTime @default(now())

  processingAttempts Int @default(0)
  lastError     String?

  folderId      String
  folder        MonitoredFolder @relation(fields: [folderId], references: [id], onDelete: Cascade)

  documents     Document[]

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([folderId])
  @@index([status])
  @@index([contentHash])
}

model MonitoredFolder {
  id          String   @id @default(cuid())
  path        String   @unique
  name        String
  isActive    Boolean  @default(true)

  scanPattern String?
  recursive   Boolean  @default(true)

  files       File[]

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Document {
  id          String   @id @default(cuid())

  fileId      String
  file        File     @relation(fields: [fileId], references: [id], onDelete: Cascade)

  qdrantPointId String
  chunkIndex    Int
  chunkText     String

  metadata      String?

  createdAt     DateTime @default(now())

  @@index([fileId])
  @@index([qdrantPointId])
}

enum FileStatus {
  PENDING
  PROCESSING
  COMPLETED
  ERROR
  MODIFIED
  DELETED
}
